---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import ContactForm from '../../components/ContactForm.astro';
import { PHONE_NUMBER, ADDRESS_LINE_1, ADDRESS_LINE_2, EMAIL_ADDRESS } from '../../consts';
import Hero2 from '../../components/Hero2.astro';

// Get all locations and sort them by state
const locations = await getCollection('location');

// Group by state
const stateGroups = locations.reduce((acc, location) => {
  const state = location.data.stateLong;
  if (!acc[state]) {
    acc[state] = [];
  }
  acc[state].push(location);
  return acc;
}, {});

// Sort states alphabetically
const sortedStates = Object.keys(stateGroups).sort();

// Sort locations within each state alphabetically by city
sortedStates.forEach(state => {
  stateGroups[state].sort((a, b) => a.data.city.localeCompare(b.data.city));
});

const locationsData = {
  hero: {
    imagePath: "/src/assets/eduardo-buscariolli-znKUv5-vadk-unsplash.jpg",
    imageAlt: "adsf",
    heading: "Our Service Areas",
    description:
      "Penn Air Repair proudly serves aircraft owners and pilots across Pennsylvania, New Jersey, New York, Maryland, and Delaware. Based at Heritage Field Airport (KPTW) in Pottstown, PA, our expert maintenance team provides top-quality service to the entire region. Whether you're looking for routine inspections, repairs, or comprehensive maintenance programs, we're here to keep your aircraft safe and airworthy.",
  },
};

const title = "Aircraft Maintenance & Repair Service Areas | Penn Air Repair";
const description = "Penn Air Repair provides expert aircraft maintenance services throughout Pennsylvania, New Jersey, New York, Maryland, and Delaware. Find your local service area.";
const keywords = "aircraft maintenance Pennsylvania, aircraft maintenance New Jersey, aircraft maintenance New York, aircraft maintenance Maryland, aircraft maintenance Delaware, regional aircraft repair, Northeast aircraft maintenance, FAA inspections, annual inspections, 100-hour inspections, regional aviation services";
---

<BaseLayout title={title} description={description} keywords={keywords}>
  <Hero2 data={locationsData.hero} />

  <div class="py-16 md:py-24 bg-white">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto">
        
        <div class="bg-gray-50 p-6 md:p-8 rounded-lg shadow-md mb-12">
          
          <h2 class="text-4xl mt-4 mb-8 text-center font-bold" id="find-your-location">Find Your Location</h2>
          
          {sortedStates.map(state => (
            <div class="mb-10" id={state}>
              <h3 class="text-2xl font-semibold mb-4 pb-2 border-b border-gray-200">{state}</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                {stateGroups[state].map(location => (
                  <a 
                    href={`/location/${location.slug}`} 
                    class="p-4 hover:bg-red-50 rounded-md transition duration-300 flex items-center"
                  >
                    <span class="text-lg text-red-900 hover:text-red-700 hover:underline">{location.data.city}</span>
                  </a>
                ))}
              </div>
            </div>
          ))}
        </div>
        
        <div class="bg-gray-50 p-6 md:p-8 rounded-lg shadow-md">
          <h2 class="text-2xl font-semibold mb-4">Why Choose Penn Air Repair?</h2>
          <ul class="list-disc pl-5 space-y-2 paragraph mb-4">
            <li>Strategic location at Heritage Field Airport (KPTW)</li>
            <li>FAA-certified maintenance technicians</li>
            <li>Comprehensive service for turboprop and piston aircraft</li>
            <li>Experience with various makes and models including Cessna, Beechcraft, and Piper</li>
            <li>Annual inspections, 100-hour inspections, and routine maintenance</li>
            <li>Engine overhaul and component repair services</li>
          </ul>
          <p class="paragraph">
            Don't see your specific location listed? Contact us anyway - we serve the entire region and can discuss your aircraft maintenance needs no matter where you're based.
          </p>
        </div>
      </div>
    </div>
  </div>
  
  <ContactForm />

  <!-- Schema.org structured data for the service areas page -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "@id": "https://pennairrepair.com/locations",
    "name": "Penn Air Repair - Multi-State Aircraft Maintenance",
    "description": "Professional aircraft maintenance and repair services throughout Pennsylvania, New Jersey, New York, Maryland, and Delaware",
    "image": "/penn-air-logo-250.webp",
    "telephone": PHONE_NUMBER,
    "email": EMAIL_ADDRESS,
    "url": "https://pennairrepair.com/locations",
    "address": {
      "@type": "PostalAddress",
      "streetAddress": ADDRESS_LINE_1,
      "addressLocality": "Pottstown",
      "addressRegion": "PA",
      "postalCode": "19464",
      "addressCountry": "US"
    },
    "geo": {
      "@type": "GeoCoordinates",
      "latitude": "40.24217243030569",
      "longitude": "-75.55532596753021"
    },
    "areaServed": [
      {
        "@type": "State",
        "name": "Pennsylvania"
      },
      {
        "@type": "State",
        "name": "New Jersey"
      },
      {
        "@type": "State",
        "name": "New York"
      },
      {
        "@type": "State", 
        "name": "Maryland"
      },
      {
        "@type": "State",
        "name": "Delaware"
      }
    ],
    "hasMap": "https://goo.gl/maps/bmxZCk894cJ2xogr7",
    "sameAs": [
      "https://pennairrepair.com/"
    ],
    "openingHoursSpecification": {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": [
        "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"
      ],
      "opens": "07:00",
      "closes": "20:00"
    }
  })} />
</BaseLayout>